"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[420],{7904:(I,M,n)=>{n.d(M,{E:()=>S});var p=n(5861),l=n(89),r=n(2223),P=n(7622),F=n(5197),L=n(1085);let S=(()=>{class v{constructor(i,c,d,u){this.firestore=i,this.authService=c,this.db=d,this.angFirestore=u;const g=(0,l.hJ)(this.firestore,"relevamiento");this.items$=(0,l.BS)(g)}savePhoto(i,c){const d=this.angFirestore.collection("fotos").doc(i);d.get().subscribe(u=>{u.exists?console.log("La foto ya existe en la base de datos"):(d.set({url:c,votos:0}),console.log("La foto se ha guardado en la base de datos"))})}getUsers(){var i=this;return(0,p.Z)(function*(){return i.db.list("users").valueChanges()})()}addItem(i){var c=this;return(0,p.Z)(function*(){const d=c.angFirestore.createId();return i.id=d,c.angFirestore.collection("relevamiento").doc(i.id).set(i)})()}getAllItems(){var i=this;return(0,p.Z)(function*(){const c=(0,l.hJ)(i.firestore,"relevamiento"),d=yield(0,l.PL)((0,l.IO)(c,(0,l.Xo)("fecha","desc"))),u=[];return d.forEach(g=>{const _=g.data();u.push(_)}),u})()}getAllItemsType(i){var c=this;return(0,p.Z)(function*(){const d=(0,l.hJ)(c.firestore,"relevamiento"),u=yield(0,l.PL)((0,l.IO)(d,(0,l.ar)("tipo","==",i)));console.log(u);const g=[];return u.forEach(_=>{const T=_.data();g.push(T)}),g})()}getAllItemsUser(i){var c=this;return(0,p.Z)(function*(){const d=(0,l.hJ)(c.firestore,"relevamiento"),u=yield(0,l.PL)((0,l.IO)(d,(0,l.ar)("name","==",i)));console.log(u);const g=[];return u.forEach(_=>{const T=_.data();g.push(T)}),g})()}updateItem(i){var c=this;return(0,p.Z)(function*(){const d=(0,l.JU)(c.firestore,"relevamiento",i.id);yield(0,l.pl)(d,i)})()}voteForPhoto(i){var c=this;return(0,p.Z)(function*(){c.firestore.toJSON.call("relevamiento")})()}}return v.\u0275fac=function(i){return new(i||v)(r.LFG(l.gg),r.LFG(P.e),r.LFG(F.KQ),r.LFG(L.ST))},v.\u0275prov=r.Yz7({token:v,factory:v.\u0275fac,providedIn:"root"}),v})()},420:(I,M,n)=>{n.r(M),n.d(M,{Tab3PageModule:()=>E});var p=n(4755),l=n(5030),r=n(2673),P=n(5559),F=n(5861),L=n(3192),S=n(4208),v=n(7072),e=n(2223),i=n(7622),c=n(7904);function d(s,f){1&s&&(e.TgZ(0,"ion-card-header")(1,"ion-card-title"),e._uU(2,"Cosas Feas"),e.qZA()())}function u(s,f){1&s&&(e.TgZ(0,"ion-card-header")(1,"ion-card-title"),e._uU(2,"Cosas Lindas"),e.qZA()())}function g(s,f){if(1&s&&(e.ynx(0),e._UZ(1,"img",8),e.BQk()),2&s){const t=e.oxw();e.xp6(1),e.Q6J("src",t.foto.image,e.LSH)}}const T=[{path:"",component:(()=>{class s{constructor(t,a,o,h,C){this.router=t,this.loginService=a,this.loadingCtrl=o,this.firestoresService=h,this.modalController=C,this.chartType="bar",this.cosasLindas=[],this.cosasFeas=[],this.fotos=["../../assets/Ohiggins1636.jpg","../../assets/Ohiggins1800.jpg","../../assets/Ohiggins2200.jpg"],this.uploading=!1,this.pieChartOptions={responsive:!0,plugins:{legend:{display:!0,position:"top"}}},this.pieChartData={labels:[["Download","Sales"],["In","Store","Sales"],"Mail Sales"],datasets:[{data:[300,500,100]}]},this.pieChartType="pie",this.barChartOptions={responsive:!0,scales:{x:{},y:{min:10}},plugins:{legend:{display:!0}}},this.barChartType="bar",this.barChartData={labels:["2006","2007","2008","2009","2010","2011","2012"],datasets:[{data:[65,59,80,81,56,55,40],label:"Series A"},{data:[28,48,40,19,86,27,90],label:"Series B"}]},this.options={onClick:(b,m)=>{m.length>0&&this.mostrarFoto(m[0]._chart.data.datasets[0].data[m[0]._index])}}}ionViewWillEnter(){this.getAllData()}logout(){this.loginService.signOut().then(()=>{this.router.navigate(["/login"])})}chartClicked(t){console.log(t)}chartHovered({event:t,active:a}){console.log(t,a)}randomize(){var t;this.barChartData.datasets[0].data=[Math.round(100*Math.random()),59,80,Math.round(100*Math.random()),56,Math.round(100*Math.random()),40],null===(t=this.chart)||void 0===t||t.update()}changeLabels(){var t;const a=["hen","variable","embryo","instal","pleasant","physical","bomber","army","add","film","conductor","comfortable","flourish","establish","circumstance","chimney","crack","hall","energy","treat","window","shareholder","division","disk","temptation","chord","left","hospital","beef","patrol","satisfied","academy","acceptance","ivory","aquarium","building","store","replace","language","redeem","honest","intention","silk","opera","sleep","innocent","ignore","suite","applaud","funny"];this.pieChartData.labels=new Array(3).map(h=>a[Math.trunc(Math.random()*a.length)]),null===(t=this.chart)||void 0===t||t.update()}addSlice(){var t;this.pieChartData.labels&&this.pieChartData.labels.push(["Line 1","Line 2","Line 3"]),this.pieChartData.datasets[0].data.push(400),null===(t=this.chart)||void 0===t||t.update()}removeSlice(){var t;this.pieChartData.labels&&this.pieChartData.labels.pop(),this.pieChartData.datasets[0].data.pop(),null===(t=this.chart)||void 0===t||t.update()}changeLegendPosition(){var t,a,o;null!==(t=this.pieChartOptions)&&void 0!==t&&null!==(a=t.plugins)&&void 0!==a&&a.legend&&(this.pieChartOptions.plugins.legend.position="left"===this.pieChartOptions.plugins.legend.position?"top":"left"),null===(o=this.chart)||void 0===o||o.render()}toggleLegend(){var t,a,o;null!==(t=this.pieChartOptions)&&void 0!==t&&null!==(a=t.plugins)&&void 0!==a&&a.legend&&(this.pieChartOptions.plugins.legend.display=!this.pieChartOptions.plugins.legend.display),null===(o=this.chart)||void 0===o||o.render()}mostrarFoto(t){this.obtenerRutaFoto(t.fecha,t.usuario)}seleccionarFotoGraficoonClick(t,a,o){this.foto=this.cosasFeas[a[0].index]}obtenerRutaFoto(t,a){const h=[{fecha:"2023-01-01",usuario:"usuario1",ruta:"assets/fotos/foto1.jpg"}].find(C=>C.fecha===t&&C.usuario===a);return h?h.ruta:null}getAllData(){var t=this;return(0,F.Z)(function*(){t.uploading=!0;const a=yield t.loadingCtrl.create({spinner:"lines",cssClass:"custom-loading"});yield a.present();try{t.cosasLindas=yield t.firestoresService.getAllItemsType("Cosas Lindas"),t.cosasFeas=yield t.firestoresService.getAllItemsType("Cosas Feas"),t.createPieChart(),t.createBarra()}catch(o){console.log("Error al obtener datos:",o)}finally{t.uploading=!1,yield a.dismiss()}})()}createBarra(){const t=document.getElementById("myChart"),a=this.cosasFeas.map(b=>b.id),o=this.cosasFeas.map(b=>{var m;return null===(m=b.votos)||void 0===m?void 0:m.length}),C=this.generateBackgroundColors(a.length);this.chart=new L.kL(t,{type:"bar",data:{labels:a,datasets:[{label:"Cantidad",data:o,backgroundColor:C}]},options:{onClick:(b,m,y)=>{this.foto=this.cosasFeas[m[0].index]},responsive:!0,scales:{xAxes:{ticks:{backdropColor:"red",backdropPadding:100,z:0}},yAxes:{grid:{display:!1}}},plugins:{legend:{display:!1}}}}),this.chart.update()}createPieChart(){const t=document.getElementById("pieChart"),a=this.cosasLindas.map(y=>y.id),o=this.cosasLindas.map(y=>{var O;return null===(O=y.votos)||void 0===O?void 0:O.length}),C=this.generateBackgroundColors(a.length);new L.kL(t,{type:"pie",data:{datasets:[{data:o,backgroundColor:C,borderWidth:1}]},options:{onClick:(y,O,Z)=>{this.foto=this.cosasLindas[O[0].index]}}})}generateBackgroundColors(t){const a=[];for(let o=0;o<t;o++){const h=this.generateRandomColor();a.push(h)}return a}generateRandomColor(){let a="#";for(let o=0;o<6;o++)a+="0123456789ABCDEF"[Math.floor(16*Math.random())];return a}verImagen(t){var a=this;return(0,F.Z)(function*(){return yield(yield a.modalController.create({component:v.l,componentProps:{imagen:t}})).present()})()}listaEdificios(){return[{flipped:!1,src:"assets/Ohiggins1636.jpg"},{flipped:!1,src:"assets/Ohiggins1800.jpg"},{flipped:!1,src:"assets/Ohiggins2200.jpg"}]}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(P.F0),e.Y36(i.e),e.Y36(r.HT),e.Y36(c.E),e.Y36(r.IN))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-tab3"]],viewQuery:function(t,a){if(1&t&&e.Gf(S.jh,5),2&t){let o;e.iGM(o=e.CRH())&&(a.chartC=o.first)}},decls:17,vars:5,consts:[[3,"translucent"],["slot","primary"],[3,"click"],["slot","icon-only","name","exit"],[3,"fullscreen"],[4,"ngIf"],["baseChart","","id","myChart","width","400","data","barChartData","options","barChartOptions","type","barChartType",1,"chart",3,"chartClick"],["baseChart","","id","pieChart","width","400","data","pieChartData","type","pieChartType","options","pieChartOptions",1,"chart",3,"chartClick"],[3,"src"]],template:function(t,a){1&t&&(e.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1)(3,"ion-button",2),e.NdJ("click",function(){return a.logout()}),e._UZ(4,"ion-icon",3),e.qZA()(),e.TgZ(5,"ion-title"),e._uU(6," Gr\xe1ficos "),e.qZA()()(),e.TgZ(7,"ion-content",4)(8,"ion-card"),e.YNc(9,d,3,0,"ion-card-header",5),e.TgZ(10,"ion-card-content")(11,"canvas",6),e.NdJ("chartClick",function(h){return a.chartClicked(h)}),e.qZA()()(),e.TgZ(12,"ion-card"),e.YNc(13,u,3,0,"ion-card-header",5),e.TgZ(14,"ion-card-content")(15,"canvas",7),e.NdJ("chartClick",function(h){return a.chartClicked(h)}),e.qZA()()(),e.YNc(16,g,2,1,"ng-container",5),e.qZA()),2&t&&(e.Q6J("translucent",!0),e.xp6(7),e.Q6J("fullscreen",!0),e.xp6(2),e.Q6J("ngIf",!a.uploading),e.xp6(4),e.Q6J("ngIf",!a.uploading),e.xp6(3),e.Q6J("ngIf",a.foto))},dependencies:[p.O5,r.YG,r.Sm,r.PM,r.FN,r.Zi,r.Dq,r.W2,r.Gu,r.gu,r.wd,r.sr],styles:["ion-card-header[_ngcontent-%COMP%]{background-color:#585454a9}ion-card-title[_ngcontent-%COMP%]{color:#f0f8ff}ion-toolbar[_ngcontent-%COMP%]{--background: rgb(107, 9, 107);color:#f0f8ff}ion-header[_ngcontent-%COMP%]{background-color:#585454a9}ion-content[_ngcontent-%COMP%]{--background: url(floor.08978e6a924b6e32.jpg)}ion-card[_ngcontent-%COMP%]{background-color:#585454a9}ion-card-header[_ngcontent-%COMP%]{background-color:green}ion-card-content[_ngcontent-%COMP%]{background-image:url(floor.08978e6a924b6e32.jpg)}"]}),s})()}];let D=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[P.Bz.forChild(T),P.Bz]}),s})();var A=n(581);let E=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[p.ez,l.u5,r.Pc,A.e,D]}),s})()}}]);